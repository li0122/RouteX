<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RouteX - 智能旅遊推薦系統</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/lib/fontawesome/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-route"></i> RouteX</h1>
            <p>AI驅動的智能旅遊推薦系統 - 讓您的旅程更精彩</p>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Input Panel -->
            <div class="input-panel">
                <h2 class="section-title">
                    <i class="fas fa-sliders-h"></i>
                    設定您的旅程
                </h2>

                <form id="recommendForm">
                    <!-- 推薦模式選擇 -->
                    <div class="form-group">
                        <label>
                            <i class="fas fa-layer-group"></i> 推薦模式
                        </label>
                        <div class="mode-selector">
                            <label class="mode-option" id="modeOptionPOI">
                                <input type="radio" name="recommendMode" value="poi" checked>
                                <div class="mode-card">
                                    <div class="mode-icon">📍</div>
                                    <div class="mode-title">單點推薦</div>
                                    <div class="mode-desc">多個獨立景點，自由選擇</div>
                                    <div class="mode-features">
                                        <span class="feature-tag">快速</span>
                                        <span class="feature-tag">5-10個景點</span>
                                    </div>
                                </div>
                            </label>
                            <label class="mode-option" id="modeOptionItinerary">
                                <input type="radio" name="recommendMode" value="itinerary">
                                <div class="mode-card">
                                    <div class="mode-icon">🗺️</div>
                                    <div class="mode-title">行程推薦</div>
                                    <div class="mode-desc">完整行程規劃，路徑優化</div>
                                    <div class="mode-features">
                                        <span class="feature-tag">智能</span>
                                        <span class="feature-tag">最短路徑</span>
                                    </div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- 活動需求輸入 -->
                    <div class="form-group">
                        <label>
                            <i class="fas fa-bullseye"></i> 您想做什麼？
                        </label>
                        <input 
                            type="text" 
                            id="activityIntent" 
                            placeholder="例如：喝咖啡、吃義大利菜、看博物館、買紀念品、欣賞風景..." 
                            style="width: 100%; padding: 12px 16px; font-size: 15px; border: 2px solid #e5e7eb; border-radius: 8px; box-sizing: border-box;"
                        >
                        <small style="color: #6b7280; margin-top: 8px; display: block;">
                            💡 <strong>提示：</strong>描述得越具體，LLM 審核就越精準。例如：「喝咖啡」、「品嚐海鮮」、「購買藝術品」
                        </small>
                        <div style="margin-top: 12px; padding: 12px; background: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 4px;">
                            <strong style="color: #92400e;">🔍 嚴格審核模式：</strong>
                            <p style="color: #92400e; margin: 4px 0 0 0; font-size: 14px;">LLM 會嚴格檢查每個地點是否符合您的需求，只推薦最相關的地方</p>
                        </div>
                    </div>

                    <!-- 地點選擇地圖 -->
                    <div class="form-group">
                        <label>
                            <i class="fas fa-map-marked-alt"></i> 在地圖上選擇地點 (舊金山灣區)
                        </label>
                        <div id="locationPickerMap" style="margin-bottom: 15px;"></div>
                        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                            <button type="button" id="setStartBtn" class="location-btn" style="flex: 1; background: #10b981;">
                                <i class="fas fa-map-marker-alt"></i> 設定出發點
                            </button>
                            <button type="button" id="setEndBtn" class="location-btn" style="flex: 1; background: #ef4444;">
                                <i class="fas fa-flag-checkered"></i> 設定目的地
                            </button>
                        </div>
                        <div class="location-display">
                            <div class="location-item">
                                <strong>🟢 出發點:</strong> 
                                <span id="startLocationDisplay">請在地圖上點擊選擇</span>
                            </div>
                            <div class="location-item">
                                <strong>🔴 目的地:</strong> 
                                <span id="endLocationDisplay">請在地圖上點擊選擇</span>
                            </div>
                        </div>
                        <small style="color: #6b7280; margin-top: 10px; display: block;">
                            💡 <strong>操作提示：</strong><br>
                            🔍 滾輪縮放 | ✋ 拖動平移 | 🖱️ 點擊選擇 | 📍 快速地標：金門大橋、漁人碼頭等<br>
                            自動顯示距離 | 懸停顯示座標
                        </small>
                        <input type="hidden" id="startLocation" required>
                        <input type="hidden" id="endLocation" required>
                    </div>

                    <!-- 推薦數量 -->
                    <div class="form-group" id="topKGroup">
                        <label for="topK">
                            <i class="fas fa-list-ol"></i> 推薦數量: <span id="topKValue">5</span>
                        </label>
                        <input 
                            type="range" 
                            id="topK" 
                            class="form-control" 
                            min="3" 
                            max="10" 
                            value="5"
                            style="cursor: pointer;"
                        >
                        <small class="mode-hint poi-hint" style="color: #6b7280; margin-top: 8px; display: block;">
                            返回多個獨立景點卡片
                        </small>
                        <small class="mode-hint itinerary-hint" style="color: #6b7280; margin-top: 8px; display: none;">
                            此為DLRM候選數量，最終行程包含3-5個景點
                        </small>
                    </div>

                    <!-- 時間預算（僅行程推薦） -->
                    <div class="form-group" id="timeBudgetGroup" style="display: none;">
                        <label for="timeBudget">
                            <i class="fas fa-clock"></i> 時間預算: <span id="timeBudgetValue">240</span> 分鐘
                        </label>
                        <input 
                            type="range" 
                            id="timeBudget" 
                            class="form-control" 
                            min="60" 
                            max="480" 
                            step="30"
                            value="240"
                            style="cursor: pointer;"
                        >
                        <small style="color: #6b7280; margin-top: 8px; display: block;">
                            AI會根據時間預算智能選擇景點數量
                        </small>
                    </div>

                    <!-- LLM過濾開關（僅單點推薦顯示） -->
                    <div class="settings-toggle" id="llmToggleGroup">
                        <label class="toggle-switch">
                            <span>
                                <i class="fas fa-robot"></i> 啟用AI智能過濾
                            </span>
                            <input type="checkbox" id="enableLLM" checked>
                        </label>
                        <small style="color: #6b7280; margin-top: 8px; display: block;">
                            過濾不適合旅客的地點（如倉儲、維修店等）
                        </small>
                    </div>

                    <!-- 提交按鈕 -->
                    <button type="submit" class="btn btn-primary" id="submitBtn">
                        <i class="fas fa-search"></i>
                        <span id="submitBtnText">開始推薦</span>
                    </button>
                </form>
            </div>

            <!-- Results Panel -->
            <div class="results-panel">
                <h2 class="section-title">
                    <i class="fas fa-star"></i>
                    推薦結果
                </h2>

                <!-- Empty State -->
                <div id="emptyState" class="empty-state">
                    <i class="fas fa-map-marked-alt"></i>
                    <h3>等待您的探索</h3>
                    <p>請設定您的旅程資訊，我們將為您推薦最佳景點</p>
                </div>

                <!-- Loading State -->
                <div id="loadingState" class="loading" style="display: none;">
                    <div class="spinner"></div>
                    <h3>正在尋找最佳推薦...</h3>
                    <p>AI正在分析您的路線和偏好</p>
                </div>

                <!-- Error State -->
                <div id="errorState" class="error-state" style="display: none;">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>發生錯誤</h3>
                    <p id="errorMessage"></p>
                </div>

                <!-- Results Container -->
                <div id="resultsContainer" style="display: none;">
                    <!-- Statistics -->
                    <div class="stats-container">
                        <div class="stat-card">
                            <div class="stat-value" id="statTotal">0</div>
                            <div class="stat-label">推薦景點</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statAvgScore">0.0</div>
                            <div class="stat-label">平均評分</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="statExtraTime">0</div>
                            <div class="stat-label">額外時間(分)</div>
                        </div>
                    </div>

                    <!-- Map -->
                    <div class="map-container">
                        <div id="map"></div>
                    </div>

                    <!-- Recommendations -->
                    <div id="recommendationsList" class="recommendations-grid"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Leaflet 地圖庫 -->
    <link rel="stylesheet" href="/static/lib/leaflet/leaflet.css">
    <script src="/static/lib/leaflet/leaflet.js"></script>
    
    <!-- SQL.js (MBTiles 離線瓦片支援) -->
    <script src="/static/lib/mbtiles/sql-wasm.js"></script>
    <script src="/static/lib/mbtiles/leaflet-mbtiles.js"></script>
    
    <!-- 地圖組件 -->
    <script src="/static/js/leaflet-map-picker.js"></script>
    <script src="/static/js/leaflet-result-map.js"></script>
    <script src="/static/js/app.js"></script>
</body>
</html>
